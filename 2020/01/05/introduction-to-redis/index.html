<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="msapplication-config" content="/images/mstile-150x150.png">
  <meta name="google-site-verification" content="Vb0EkkfGHD4yjSK3hHo9zSszfnkbr8wPpPDCVVtvxDg">
  <meta name="msvalidate.01" content="BB5484EDD5B0CB57C647B2184772CBDC">
  <meta name="baidu-site-verification" content="aYgTqx38cK">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"stornado.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Introduction to Redis Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists,">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 简介">
<meta property="og:url" content="https://stornado.github.io/2020/01/05/introduction-to-redis/index.html">
<meta property="og:site_name" content="仲夏叶 | Stornado">
<meta property="og:description" content="Introduction to Redis Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists,">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-01-05T05:33:05.000Z">
<meta property="article:modified_time" content="2022-08-04T06:23:25.666Z">
<meta property="article:author" content="仲夏叶">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://stornado.github.io/2020/01/05/introduction-to-redis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis 简介 | 仲夏叶 | Stornado</title>
  


  <script data-pjax="">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e1d846feb2f251f98b0482d1f5fd6a4e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">仲夏叶 | Stornado</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">生命就是用求知的欲望燃烧自己</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">28</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">31</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/stornado" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://stornado.github.io/2020/01/05/introduction-to-redis/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="仲夏叶">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="仲夏叶 | Stornado">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis 简介<a href="https://github.com/stornado/stornado.github.io/tree/develop/source/_posts/introduction-to-redis.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pencil-alt"></i></a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-05 13:33:05" itemprop="dateCreated datePublished" datetime="2020-01-05T13:33:05+08:00">2020-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-04 14:23:25" itemprop="dateModified" datetime="2022-08-04T14:23:25+08:00">2022-08-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/database/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 ≈</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="introduction-to-redis">Introduction to Redis</h1>
<p>Redis is an open source (BSD licensed), in-memory <strong>data
structure store</strong>, used as a database, cache and message broker.
It supports data structures such as <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#strings">strings</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#hashes">hashes</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#lists">lists</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#sets">sets</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#sorted-sets">sorted
sets</a> with range queries, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#bitmaps">bitmaps</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#hyperloglogs">hyperloglogs</a>,
<a target="_blank" rel="noopener" href="https://redis.io/commands/geoadd">geospatial indexes</a> with
radius queries and <a target="_blank" rel="noopener" href="https://redis.io/topics/streams-intro">streams</a>. Redis has
built-in <a target="_blank" rel="noopener" href="https://redis.io/topics/replication">replication</a>,
<a target="_blank" rel="noopener" href="https://redis.io/commands/eval">Lua scripting</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/lru-cache">LRU eviction</a>, <a target="_blank" rel="noopener" href="https://redis.io/topics/transactions">transactions</a> and
different levels of <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence">on-disk persistence</a>, and
provides high availability via <a target="_blank" rel="noopener" href="https://redis.io/topics/sentinel">Redis Sentinel</a> and automatic
partitioning with <a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">Redis Cluster</a>.</p>
<span id="more"></span>
<p>You can run <strong>atomic operations</strong> on these types, like
<a target="_blank" rel="noopener" href="https://redis.io/commands/append">appending to a string</a>; <a target="_blank" rel="noopener" href="https://redis.io/commands/hincrby">incrementing the value in a
hash</a>; <a target="_blank" rel="noopener" href="https://redis.io/commands/lpush">pushing an element
to a list</a>; <a target="_blank" rel="noopener" href="https://redis.io/commands/sinter">computing set
intersection</a>, <a target="_blank" rel="noopener" href="https://redis.io/commands/sunion">union</a>
and <a target="_blank" rel="noopener" href="https://redis.io/commands/sdiff">difference</a>; or <a target="_blank" rel="noopener" href="https://redis.io/commands/zrangebyscore">getting the member with
highest ranking in a sorted set</a>.</p>
<p>In order to achieve its outstanding performance, Redis works with an
<strong>in-memory dataset</strong>. Depending on your use case, you can
persist it either by <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence#snapshotting">dumping the
dataset to disk</a> every once in a while, or by <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence#append-only-file">appending
each command to a log</a>. Persistence can be optionally disabled, if
you just need a feature-rich, networked, in-memory cache.</p>
<p>Redis also supports trivial-to-setup <a target="_blank" rel="noopener" href="https://redis.io/topics/replication">master-slave asynchronous
replication</a>, with very fast non-blocking first synchronization,
auto-reconnection with partial resynchronization on net split.</p>
<p>Other features include:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/transactions">Transactions</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/pubsub">Pub/Sub</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/eval">Lua scripting</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/expire">Keys with a limited
time-to-live</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/lru-cache">LRU eviction of
keys</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/sentinel">Automatic
failover</a></li>
</ul>
<p>You can use Redis from <a target="_blank" rel="noopener" href="https://redis.io/clients">most
programming languages</a> out there.</p>
<p>Redis is written in <strong>ANSI C</strong> and works in most POSIX
systems like Linux, <em>BSD, OS X without external dependencies. Linux
and OS X are the two operating systems where Redis is developed and
tested the most, and we <strong>recommend using Linux for
deploying</strong>. Redis may work in Solaris-derived systems like
SmartOS, but the support is </em>best effort*. There is no official
support for Windows builds.</p>
<h1 id="redis-sentinel-documentation">Redis Sentinel Documentation</h1>
<p>Redis Sentinel provides high availability for Redis. In practical
terms this means that using Sentinel you can create a Redis deployment
that resists without human intervention certain kinds of failures.</p>
<p>Redis Sentinel also provides other collateral tasks such as
monitoring, notifications and acts as a configuration provider for
clients.</p>
<p>This is the full list of Sentinel capabilities at a macroscopical
level (i.e. the <em>big picture</em>):</p>
<ul>
<li><strong>Monitoring</strong>. Sentinel constantly checks if your
master and replica instances are working as expected.</li>
<li><strong>Notification</strong>. Sentinel can notify the system
administrator, or other computer programs, via an API, that something is
wrong with one of the monitored Redis instances.</li>
<li><strong>Automatic failover</strong>. If a master is not working as
expected, Sentinel can start a failover process where a replica is
promoted to master, the other additional replicas are reconfigured to
use the new master, and the applications using the Redis server are
informed about the new address to use when connecting.</li>
<li><strong>Configuration provider</strong>. Sentinel acts as a source
of authority for clients service discovery: clients connect to Sentinels
in order to ask for the address of the current Redis master responsible
for a given service. If a failover occurs, Sentinels will report the new
address.</li>
</ul>
<h2 id="distributed-nature-of-sentinel">Distributed nature of
Sentinel</h2>
<p>Redis Sentinel is a distributed system:</p>
<p>Sentinel itself is designed to run in a configuration where there are
multiple Sentinel processes cooperating together. The advantage of
having multiple Sentinel processes cooperating are the following:</p>
<ol type="1">
<li>Failure detection is performed when multiple Sentinels agree about
the fact a given master is no longer available. This lowers the
probability of false positives.</li>
<li>Sentinel works even if not all the Sentinel processes are working,
making the system robust against failures. There is no fun in having a
failover system which is itself a single point of failure, after
all.</li>
</ol>
<p>The sum of Sentinels, Redis instances (masters and replicas) and
clients connecting to Sentinel and Redis, are also a larger distributed
system with specific properties. In this document concepts will be
introduced gradually starting from basic information needed in order to
understand the basic properties of Sentinel, to more complex information
(that are optional) in order to understand how exactly Sentinel
works.</p>
<h1 id="redis-cluster-specification">Redis Cluster Specification</h1>
<p>Welcome to the <strong>Redis Cluster Specification</strong>. Here
you'll find information about algorithms and design rationales of Redis
Cluster. This document is a work in progress as it is continuously
synchronized with the actual implementation of Redis.</p>
<h2 id="main-properties-and-rationales-of-the-design">Main properties
and rationales of the design</h2>
<h3 id="redis-cluster-goals">Redis Cluster goals</h3>
<p>Redis Cluster is a distributed implementation of Redis with the
following goals, in order of importance in the design:</p>
<ul>
<li>High performance and linear scalability up to 1000 nodes. There are
no proxies, asynchronous replication is used, and no merge operations
are performed on values.</li>
<li>Acceptable degree of write safety: the system tries (in a
best-effort way) to retain all the writes originating from clients
connected with the majority of the master nodes. Usually there are small
windows where acknowledged writes can be lost. Windows to lose
acknowledged writes are larger when clients are in a minority
partition.</li>
<li>Availability: Redis Cluster is able to survive partitions where the
majority of the master nodes are reachable and there is at least one
reachable slave for every master node that is no longer reachable.
Moreover using <em>replicas migration</em>, masters no longer replicated
by any slave will receive one from a master which is covered by multiple
slaves.</li>
</ul>
<p>What is described in this document is implemented in Redis 3.0 or
greater.</p>
<h3 id="implemented-subset">Implemented subset</h3>
<p>Redis Cluster implements all the single key commands available in the
non-distributed version of Redis. Commands performing complex multi-key
operations like Set type unions or intersections are implemented as well
as long as the keys all hash to the same slot.</p>
<p>Redis Cluster implements a concept called <strong>hash tags</strong>
that can be used in order to force certain keys to be stored in the same
hash slot. However during manual resharding, multi-key operations may
become unavailable for some time while single key operations are always
available.</p>
<p>Redis Cluster does not support multiple databases like the stand
alone version of Redis. There is just database 0 and the <a target="_blank" rel="noopener" href="https://redis.io/commands/select">SELECT</a> command is not
allowed.</p>
<h3 id="clients-and-servers-roles-in-the-redis-cluster-protocol">Clients
and Servers roles in the Redis Cluster protocol</h3>
<p>In Redis Cluster nodes are responsible for holding the data, and
taking the state of the cluster, including mapping keys to the right
nodes. Cluster nodes are also able to auto-discover other nodes, detect
non-working nodes, and promote slave nodes to master when needed in
order to continue to operate when a failure occurs.</p>
<p>To perform their tasks all the cluster nodes are connected using a
TCP bus and a binary protocol, called the <strong>Redis Cluster
Bus</strong>. Every node is connected to every other node in the cluster
using the cluster bus. Nodes use a gossip protocol to propagate
information about the cluster in order to discover new nodes, to send
ping packets to make sure all the other nodes are working properly, and
to send cluster messages needed to signal specific conditions. The
cluster bus is also used in order to propagate Pub/Sub messages across
the cluster and to orchestrate manual failovers when requested by users
(manual failovers are failovers which are not initiated by the Redis
Cluster failure detector, but by the system administrator directly).</p>
<p>Since cluster nodes are not able to proxy requests, clients may be
redirected to other nodes using redirection errors <code>-MOVED</code>
and <code>-ASK</code>. The client is in theory free to send requests to
all the nodes in the cluster, getting redirected if needed, so the
client is not required to hold the state of the cluster. However clients
that are able to cache the map between keys and nodes can improve the
performance in a sensible way.</p>
<h3 id="write-safety">Write safety</h3>
<p>Redis Cluster uses asynchronous replication between nodes, and
<strong>last failover wins</strong> implicit merge function. This means
that the last elected master dataset eventually replaces all the other
replicas. There is always a window of time when it is possible to lose
writes during partitions. However these windows are very different in
the case of a client that is connected to the majority of masters, and a
client that is connected to the minority of masters.</p>
<p>Redis Cluster tries harder to retain writes that are performed by
clients connected to the majority of masters, compared to writes
performed in the minority side. The following are examples of scenarios
that lead to loss of acknowledged writes received in the majority
partitions during failures:</p>
<ol type="1">
<li>A write may reach a master, but while the master may be able to
reply to the client, the write may not be propagated to slaves via the
asynchronous replication used between master and slave nodes. If the
master dies without the write reaching the slaves, the write is lost
forever if the master is unreachable for a long enough period that one
of its slaves is promoted. This is usually hard to observe in the case
of a total, sudden failure of a master node since masters try to reply
to clients (with the acknowledge of the write) and slaves (propagating
the write) at about the same time. However it is a real world failure
mode.</li>
<li>Another theoretically possible failure mode where writes are lost is
the following:</li>
</ol>
<ul>
<li>A master is unreachable because of a partition.</li>
<li>It gets failed over by one of its slaves.</li>
<li>After some time it may be reachable again.</li>
<li>A client with an out-of-date routing table may write to the old
master before it is converted into a slave (of the new master) by the
cluster.</li>
</ul>
<p>The second failure mode is unlikely to happen because master nodes
unable to communicate with the majority of the other masters for enough
time to be failed over will no longer accept writes, and when the
partition is fixed writes are still refused for a small amount of time
to allow other nodes to inform about configuration changes. This failure
mode also requires that the client's routing table has not yet been
updated.</p>
<p>Writes targeting the minority side of a partition have a larger
window in which to get lost. For example, Redis Cluster loses a
non-trivial number of writes on partitions where there is a minority of
masters and at least one or more clients, since all the writes sent to
the masters may potentially get lost if the masters are failed over in
the majority side.</p>
<p>Specifically, for a master to be failed over it must be unreachable
by the majority of masters for at least <code>NODE_TIMEOUT</code>, so if
the partition is fixed before that time, no writes are lost. When the
partition lasts for more than <code>NODE_TIMEOUT</code>, all the writes
performed in the minority side up to that point may be lost. However the
minority side of a Redis Cluster will start refusing writes as soon as
<code>NODE_TIMEOUT</code> time has elapsed without contact with the
majority, so there is a maximum window after which the minority becomes
no longer available. Hence, no writes are accepted or lost after that
time.</p>
<h3 id="availability">Availability</h3>
<p>Redis Cluster is not available in the minority side of the partition.
In the majority side of the partition assuming that there are at least
the majority of masters and a slave for every unreachable master, the
cluster becomes available again after <code>NODE_TIMEOUT</code> time
plus a few more seconds required for a slave to get elected and failover
its master (failovers are usually executed in a matter of 1 or 2
seconds).</p>
<p>This means that Redis Cluster is designed to survive failures of a
few nodes in the cluster, but it is not a suitable solution for
applications that require availability in the event of large net
splits.</p>
<p>In the example of a cluster composed of N master nodes where every
node has a single slave, the majority side of the cluster will remain
available as long as a single node is partitioned away, and will remain
available with a probability of <code>1-(1/(N*2-1))</code> when two
nodes are partitioned away (after the first node fails we are left with
<code>N*2-1</code> nodes in total, and the probability of the only
master without a replica to fail is <code>1/(N*2-1))</code>.</p>
<p>For example, in a cluster with 5 nodes and a single slave per node,
there is a <code>1/(5*2-1) = 11.11%</code> probability that after two
nodes are partitioned away from the majority, the cluster will no longer
be available.</p>
<p>Thanks to a Redis Cluster feature called <strong>replicas
migration</strong> the Cluster availability is improved in many real
world scenarios by the fact that replicas migrate to orphaned masters
(masters no longer having replicas). So at every successful failure
event, the cluster may reconfigure the slaves layout in order to better
resist the next failure.</p>
<h3 id="performance">Performance</h3>
<p>In Redis Cluster nodes don't proxy commands to the right node in
charge for a given key, but instead they redirect clients to the right
nodes serving a given portion of the key space.</p>
<p>Eventually clients obtain an up-to-date representation of the cluster
and which node serves which subset of keys, so during normal operations
clients directly contact the right nodes in order to send a given
command.</p>
<p>Because of the use of asynchronous replication, nodes do not wait for
other nodes' acknowledgment of writes (if not explicitly requested using
the <a target="_blank" rel="noopener" href="https://redis.io/commands/wait">WAIT</a> command).</p>
<p>Also, because multi-key commands are only limited to <em>near</em>
keys, data is never moved between nodes except when resharding.</p>
<p>Normal operations are handled exactly as in the case of a single
Redis instance. This means that in a Redis Cluster with N master nodes
you can expect the same performance as a single Redis instance
multiplied by N as the design scales linearly. At the same time the
query is usually performed in a single round trip, since clients usually
retain persistent connections with the nodes, so latency figures are
also the same as the single standalone Redis node case.</p>
<p>Very high performance and scalability while preserving weak but
reasonable forms of data safety and availability is the main goal of
Redis Cluster.</p>
<h3 id="why-merge-operations-are-avoided">Why merge operations are
avoided</h3>
<p>Redis Cluster design avoids conflicting versions of the same
key-value pair in multiple nodes as in the case of the Redis data model
this is not always desirable. Values in Redis are often very large; it
is common to see lists or sorted sets with millions of elements. Also
data types are semantically complex. Transferring and merging these kind
of values can be a major bottleneck and/or may require the non-trivial
involvement of application-side logic, additional memory to store
meta-data, and so forth.</p>
<p>There are no strict technological limits here. CRDTs or synchronously
replicated state machines can model complex data types similar to Redis.
However, the actual run time behavior of such systems would not be
similar to Redis Cluster. Redis Cluster was designed in order to cover
the exact use cases of the non-clustered Redis version.</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2019/12/29/redis-info-command-intro/" rel="bookmark">Redis info 命令简介</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="仲夏叶 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="仲夏叶 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>仲夏叶
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://stornado.github.io/2020/01/05/introduction-to-redis/" title="Redis 简介">https://stornado.github.io/2020/01/05/introduction-to-redis/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"><i class="fa fa-tag"></i> redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/04/structure-thinking/" rel="prev" title="结构化思维">
      <i class="fa fa-chevron-left"></i> 结构化思维
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/05/structure-thinking-methods/" rel="next" title="结构化思维方法">
      结构化思维方法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>



        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduction-to-redis"><span class="nav-number">1.</span> <span class="nav-text">Introduction to Redis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redis-sentinel-documentation"><span class="nav-number">2.</span> <span class="nav-text">Redis Sentinel Documentation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#distributed-nature-of-sentinel"><span class="nav-number">2.1.</span> <span class="nav-text">Distributed nature of
Sentinel</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redis-cluster-specification"><span class="nav-number">3.</span> <span class="nav-text">Redis Cluster Specification</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#main-properties-and-rationales-of-the-design"><span class="nav-number">3.1.</span> <span class="nav-text">Main properties
and rationales of the design</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-cluster-goals"><span class="nav-number">3.1.1.</span> <span class="nav-text">Redis Cluster goals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#implemented-subset"><span class="nav-number">3.1.2.</span> <span class="nav-text">Implemented subset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clients-and-servers-roles-in-the-redis-cluster-protocol"><span class="nav-number">3.1.3.</span> <span class="nav-text">Clients
and Servers roles in the Redis Cluster protocol</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#write-safety"><span class="nav-number">3.1.4.</span> <span class="nav-text">Write safety</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#availability"><span class="nav-number">3.1.5.</span> <span class="nav-text">Availability</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#performance"><span class="nav-number">3.1.6.</span> <span class="nav-text">Performance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-merge-operations-are-avoided"><span class="nav-number">3.1.7.</span> <span class="nav-text">Why merge operations are
avoided</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="仲夏叶" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">仲夏叶</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/stornado" title="GitHub → https://github.com/stornado" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ryan@zxytech.com" title="E-Mail → mailto:ryan@zxytech.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ryanstornado" title="Twitter → https://twitter.com/ryanstornado" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  © 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">仲夏叶</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">254k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:51</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        


  <div style="display: none;">
    <script data-pjax="" src="//s95.cnzz.com/z_stat.php?id=1254452804&amp;web_id=1254452804"></script>
  </div>






      </div>
    </footer>
  </div>

  
  
  
  
  













  



  
  <script src="https://unpkg.com/mermaid@/dist/mermaid.min.js"></script>
  
  <style>
    .mermaid {
      background: var(--body-bg-color);
    }
  </style>



  




  















    <div id="pjax">
  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">



    </div>


<script src="/bundle.js"></script><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
;

var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
;

    if (window.mermaid) {
      mermaid.initialize({'theme': 'forest'});
    }
  ;

if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
;

NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'debe3bf900ab05b9ae3b',
      clientSecret: '3593904f48e12175e52c39855bcc80018f0831f8',
      repo        : 'stornado.github.io',
      owner       : 'stornado',
      admin       : ['stornado'],
      id          : 'abb3a0a676bccdf11efeebcabae81cd4',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>